<div class="container">
    <h1>Welcome, {{ details?.name }}!</h1>

<br>
<div class="row">
  <div class="col s12 m4 offset-m4">
    <div class="card red lighten-2">
      <div class="card-content white-text">
        <span class="card-title">Add a book to exchange!</span>
      </div>
      <div class="card-action">
        <a id="add-book"[routerLink]="['/add-book']">Add New Book</a>
      </div>
    </div>
  </div>
</div>
<div *ngIf="details.address == 'none'"  id='address-alert' class='container1'>
    <h3>You do not currently have an address in your account!  Please add an address to make any exchanges.</h3>
    <form #f="ngForm" (ngSubmit)="updateAddress(f, details.email)" novalidate>
        <div class="row">
          <div class="input-field col s12">
            <textarea name="addressField" ngModel></textarea>
            <label for="addressField">Address</label>
          </div>
        </div>

        <button class="btn waves-effect waves-light" type="submit">Submit</button>
      </form>
</div>


  <!-- <br> -->
  
  <!-- <ul class="collapsible popout" data-collapsible="accordion"> -->
    <!-- <li> -->
    <h2>My  Books</h2>
      <div class="container1">
      <div class="myBooks" ng-click="myFunc()">
       </div>
      
      <div >

        <span>
          <table class="bordered">
            <thead>
              <tr>
                <!-- <th>ID</th> -->
                <th>Title</th>
                <th>Author</th>
                <th>Status</th>
                <th>Borrower Address</th>
                <th></th>
              </tr>
            </thead>
  
            <tbody *ngIf="details.books">
              <tr *ngFor='let book of details.books'>
                <!-- <td>{{bookIsbn}}</td> -->
                <td>
                  <div>
                  <div>
                    <p>{{book.title}}</p>
                  </div>
                </div></td>
                <td>
                  <div>
                    <div>
                      <p>{{book.authors}}</p>
                    </div>
                  </div>
                </td>
                <td>
                  <ng-container *ngFor="let aDeal of details.deals">
                    <ng-container *ngFor='let aIdentifier of book.industryIdentifiers'>
                      <span *ngIf='aDeal.isbn == aIdentifier.identifier && aDeal.status && aDeal.lender == details.email'>{{aDeal.status}}</span>
                    </ng-container>
                  </ng-container>
                </td>
                <td>
                  <ng-container *ngFor="let aDeal of details.deals">
                    <ng-container *ngFor='let aIdentifier of book.industryIdentifiers'>
                      <span *ngIf='aDeal.isbn == aIdentifier.identifier && aDeal.status && aDeal.lender == details.email'>{{aDeal.borrowerAddress}}</span>
                    </ng-container>
                  </ng-container>
                </td>
                <td>
                  <ng-container *ngFor="let aDeal of details.deals">
                    <ng-container *ngFor='let aIdentifier of book.industryIdentifiers'>
                      <button *ngIf='aDeal.isbn == aIdentifier.identifier && aDeal.status == "RequestedToBorrow" && aDeal.lender == details.email' (click)='acceptDeal(aDeal._id)' class="btn waves-effect waves-light" type="submit">Accept Deal</button>
                      <button *ngIf='aDeal.isbn == aIdentifier.identifier && aDeal.status == "shipBook" && aDeal.lender == details.email' (click)='shipBook(aDeal._id)' class="btn waves-effect waves-light" type="submit">Book Shipped</button>
                    </ng-container>
                  </ng-container>
                </td>
              </tr> 
            </tbody>
          </table>
  
        </span>
      </div>

      

      
    <!-- </li> -->
    <!-- <li>
      <div class="collapsible-header">
        Books Borrowed</div>
      <div class="collapsible-body">
        <span>
          <table class="bordered">
            <thead>
              <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Author</th>
                <th>Requested</th>
                <th>Accepted</th>
                <th>Shipped to Reader</th>
                <th>Due Date</th>
                <th>Shipped to Lender</th>
  
              </tr>
            </thead>
  
            <tbody>
              <tr>
                <td>Number</td>
                <td>String</td>
                <td>String</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
              </tr>
              <tr>
                <td>Number</td>
                <td>String</td>
                <td>String</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
              </tr>
              <tr>
                <td>Number</td>
                <td>String</td>
                <td>String</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
              </tr>
            </tbody>
          </table>
  
        </span>
      </div>
    </li>
    <li>
      <div class="collapsible-header">
        Books Lent</div>
      <div class="collapsible-body">
        <span>
          <table class="bordered">
            <thead>
              <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Author</th>
                <th>Requested</th>
                <th>Accepted</th>
                <th>Shipped to Reader</th>
                <th>Due Date</th>
                <th>Shipped to Lender</th>
  
              </tr>
            </thead>
  
            <tbody>
              <tr>
                <td>Number</td>
                <td>String</td>
                <td>String</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
              </tr>
              <tr>
                <td>Number</td>
                <td>String</td>
                <td>String</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
              </tr>
              <tr>
                <td>Number</td>
                <td>String</td>
                <td>String</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
                <td>Date</td>
              </tr>
            </tbody>
          </table>
  
        </span>
      </div>
    </li> -->
  <!-- </ul> -->
  </div>


  <h2>My Borrowed Books</h2>
      <div class="container1">
      <div class="myBooks" ng-click="myFunc()">
       </div>
      
      <div >

        <span>
          <table class="bordered">
            <thead>
              <tr>
                <!-- <th>ID</th> -->
                <th>ISBN</th>
                <th>Lender</th>
                <th>Status</th>
                <th>Date Requested</th>
                <th>Lender Address</th>
                <th>Shipping Cost</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let aBorrowDeal of details.deals">
              <ng-container *ngIf="aBorrowDeal.borrower == details.email">
              <tr>
                <!-- <td>{{bookIsbn}}</td> -->
                <td>
                  <div>
                  <div>
                    <p>{{aBorrowDeal.isbn}}</p>
                  </div>
                </div></td>
                <td>
                  <div>
                    <div>
                      <p>{{aBorrowDeal.lender}}</p>
                    </div>
                  </div>
                </td>
                <td>{{aBorrowDeal.status}}</td>
                <td>{{aBorrowDeal.date}}</td>
                <td>{{aBorrowDeal.lenderAddress}}</td>
                <td>$9.99</td>
                <td>
                      <button *ngIf='aBorrowDeal.status == "sendPayment" && aBorrowDeal.borrower == details.email' (click)='sendPayment(aBorrowDeal._id)' class="btn waves-effect waves-light" type="submit">Sent Payment</button>
                      <button *ngIf='aBorrowDeal.status == "shipBookBack" && aBorrowDeal.borrower == details.email' (click)='shipBookBack(aBorrowDeal._id)' class="btn waves-effect waves-light" type="submit">Shipped Back</button>
                </td>
              </tr>
            </ng-container>
          </ng-container>
            </tbody>
          </table>
  
        </span>
      </div>
      </div>


  </div>


<script>
   $(document).ready(function(){ $('.collapsible').collapsible(); });
</script>
